### 📌 脚本名称

**小鹅通 m3u8 导出 / 一键复制工具**

---

### 🎯 功能说明

本脚本用于在 **小鹅通网页端课程播放页面** 中：

* 自动监听 `fetch / XMLHttpRequest` 请求
* 捕获播放过程中出现的 `.m3u8` 地址
* 基于规则对 m3u8 进行评分，智能识别主播放列表（master m3u8）
* 自动获取当前课程 / 课时标题
* 支持：

  * 📥 一键导出为 JSON 文件
  * 📋 一键复制 m3u8 信息到剪贴板

适合作为 **视频下载、转码、分析工具（如 ffmpeg / Python 脚本）** 的前置辅助。

---

### 🌐 适用站点

* `*.xiaoeknow.com`
* `*.h5.xet.citv.cn`

> ⚠️ 仅对网页端播放页面生效，小程序 / App 不适用。

---

### 🧩 使用前准备

1. 浏览器已安装 **Tampermonkey（油猴）**
2. 已正确安装并启用本脚本
3. 使用 **PC 浏览器（Chrome / Edge / Firefox 推荐）**

---

### ▶️ 使用步骤

#### 1️⃣ 打开课程播放页面

进入小鹅通课程详情页，并确保页面已正常加载。

#### 2️⃣ 播放视频（关键步骤）

点击播放视频，脚本会在后台自动执行以下操作：

* 监听所有网络请求
* 捕获页面中出现的 `.m3u8` 地址
* 持续累计候选 m3u8 列表

> ⚠️ 若未播放视频，脚本无法获取 m3u8。

---

#### 3️⃣ 使用右下角功能按钮

页面右下角会出现两个悬浮按钮：

##### 🔵「导出本课」

* 自动选择评分最高的 m3u8（通常为 master m3u8）
* 获取当前课程标题
* 生成如下结构的 JSON 文件并自动下载：

```json
[
  {
    "title": "课程标题",
    "m3u8": "https://xxx/playlist.m3u8"
  }
]
```

文件名默认：`m3u8_list.json`

---

##### 🟢「一键复制」

* 执行与导出相同的 m3u8 识别逻辑
* 将当前课程的 `{ title, m3u8 }` 信息复制到剪贴板
* 可直接粘贴到：

  * ffmpeg 命令
  * Python 下载脚本
  * 其他自定义工具

复制内容示例：

```json
{
  "title": "课程标题",
  "m3u8": "https://xxx/playlist.m3u8"
}
```

---

### 🧠 m3u8 识别策略说明（简要）

脚本会对捕获到的 m3u8 地址进行评分，优先级规则包括：

* URL 长度（通常 master m3u8 更长）
* 是否包含关键字：`master / index / playlist`
* 是否包含鉴权参数：`token / sign / expires`

评分最高的 m3u8 会被视为主播放列表。

---

### ⚠️ 常见问题

**Q：点击按钮提示「请先播放课程」？**
A：说明当前页面尚未捕获到 m3u8，请先点击视频播放几秒钟。

---

**Q：复制失败或无反应？**
A：请确认浏览器已允许页面访问剪贴板权限，或尝试使用 HTTPS 页面。

---

**Q：是否支持 DRM 视频？**
A：本脚本仅用于 m3u8 地址识别，不保证 DRM 加密视频可正常下载。

---

### 📎 注意事项

* 本脚本仅用于 **技术学习与个人研究**
* 请遵守课程平台的相关协议与版权规定
* 作者不对滥用行为承担责任

---
